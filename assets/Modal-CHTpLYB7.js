import{r as a,k as K,P as m,j as e,m as v,n as _,d as k,o as P}from"./index-Bbv6LWVa.js";import{S}from"./Button-DpJdQcSW.js";const j=()=>{const t=a.useContext(K);if(!t)throw new Error("ApiKeyContext must be used within an ApiKeyProvider. Please ensure it is correctly nested within the provider.");return t},C="_apiKeyModal_pkc19_1",E="_modalContent_pkc19_14",I="_modalTitle_pkc19_28",R="_modalActions_pkc19_55",w="_error_pkc19_88",o={apiKeyModal:C,modalContent:E,modalTitle:I,modalActions:R,error:w},M=t=>/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t);function T({isOpen:t,onClose:f,onSuccess:g}){const[n,l]=a.useState(""),[c,r]=a.useState(""),[i,d]=a.useState(!1),{handleApiKeySubmitted:x}=j(),u=a.useRef(null);a.useEffect(()=>{t&&u.current&&u.current.focus()},[t]);const A=async p=>{if(p.preventDefault(),!M(n)){r("Invalid API key format. Please enter a valid HYAS API key.");return}try{d(!0),r("");const y=await v(n);await _(y),l("");try{const s=k.getOrganizationList();if(s&&s.length>0)console.log("Organizations in store.");else{const h=await P();if(!h.success){r(h.error),d(!1);return}console.log("Organizations fetched and stored.")}x(),g(!0)}catch(s){console.error("Error fetching organizations:",s),r("Error fetching organizations list. Please try again.")}}catch(y){console.error("Error storing API key:",y),r("Error storing API key. Please try again.")}finally{d(!1)}},b=()=>{l(""),r(""),f(),g(!1)};return t?e.jsxs("div",{className:o.apiKeyModal,role:"dialog","aria-labelledby":"modal-title","aria-modal":"true","aria-hidden":!t,children:[e.jsxs("div",{className:o.modalContent,children:[e.jsx("h3",{className:o.modalTitle,children:"API Key Required"}),e.jsx("p",{children:"Please enter your API key to continue:"}),e.jsxs("form",{onSubmit:A,children:[e.jsx("input",{type:"password",value:n,ref:u,onChange:p=>{r(""),l(p.target.value)},"aria-invalid":!!c,"aria-describedby":"api-key-error"}),c&&e.jsx("p",{id:"api-key-error",className:o.error,"aria-live":"assertive",children:c}),e.jsxs("div",{className:o.modalActions,children:[e.jsx("button",{type:"submit",disabled:i,children:i?"Submitting...":"Submit"}),e.jsx("button",{type:"button",onClick:b,disabled:i,children:"Cancel"})]})]})]}),i&&e.jsx(S,{"aria-label":"Loading..."})]}):null}T.propTypes={isOpen:m.bool.isRequired,onClose:m.func.isRequired,onSuccess:m.func.isRequired};export{T as M,j as u};
